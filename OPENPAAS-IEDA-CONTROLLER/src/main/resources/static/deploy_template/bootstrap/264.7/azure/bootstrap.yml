---
name: bosh

releases:
- name: bosh
  url: file:////home/cloud4u/.bosh_plugin/release/bosh-264.7.0.tgz
- name: bosh-azure-cpi
  url: file:////home/cloud4u/.bosh_plugin/release/bosh-azure-cpi-release-35.0.0.tgz

resource_pools:
- name: vms
  network: public
  stemcell: 
    url: file:////home/cloud4u/.bosh_plugin/stemcell/bosh-stemcell-3468.21-azure-hyperv-ubuntu-trusty-go_agent.tgz
  cloud_properties: 
    instance_type: Standard_D1_v2
  env:
    bosh:
      password: $6$bTqDjkjyfN$xvKE8PUfm7s9djZ9WEgUirJjq9MYUhw0PybfOqyRweUrP9GYO.Y1CcP9Ladj9iH1tEVD1wRAl1Yt6Mp5JP5y9/

disk_pools:
- name: disks
  disk_size: 40960

networks:
- name: private
  type: manual
  subnets:
  - range: 192.168.10.0/24
    gateway: 192.168.10.1
    static: [192.168.10.20]
    dns: [8.8.8.8]
    cloud_properties: 
      virtual_network_name: bootstrap_deploy
      subnet_name: bootstrap_deploy_sub
- name: public
  type: vip

instance_groups:
- name: bosh
  instances: 1
  jobs:
  - {name: nats, release: bosh}
  - {name: postgres-9.4, release: bosh}
  - {name: blobstore, release: bosh}
  - {name: director, release: bosh}
  - {name: health_monitor, release: bosh}
  - {name: registry, release: bosh}
  - {name: azure_cpi, release: bosh-azure-cpi}
  resource_pool: vms
  persistent_disk_pool: disks
  networks:
  - name: private
    static_ips: [192.168.10.20]
    default: [dns, gateway]
  - name: public
    static_ips: [52.231.198.194]
  properties:
    nats:
      address: 192.168.10.20
      user: nats
      password: nats-password
      tls:
        ca: ((nats_server_tls.ca))
        client_ca:
          certificate: ((nats_ca.certificate))
          private_key: ((nats_ca.private_key))
        server:
          certificate: ((nats_server_tls.certificate))
          private_key: ((nats_server_tls.private_key))
        director:
          certificate: ((nats_clients_director_tls.certificate))
          private_key: ((nats_clients_director_tls.private_key))
        health_monitor:
          certificate: ((nats_clients_health_monitor_tls.certificate))
          private_key: ((nats_clients_health_monitor_tls.private_key))
    postgres: &db
      listen_address: 127.0.0.1
      host: 127.0.0.1
      user: postgres
      password: postgres-password
      database: bosh
      adapter: postgres
    blobstore:
      address: 192.168.10.20
      port: 25250
      provider: dav
      director:
        user: director
        password: director-password
      agent:
        user: agent
        password: agent-password
    director:
      default_ssh_options:
        gateway_host: 52.231.198.194
      address: 127.0.0.1
      name: abosh
      db: *db
      flush_arp: true
      enable_post_deploy: true
      generate_vm_passwords: true
      enable_dedicated_status_worker: true
      enable_nats_delivered_templates: true
      workers: 4
      local_dns:
        enabled: true
      events:
        record_events: true
      ssl:
        key: ((director_ssl.private_key))
        cert: ((director_ssl.certificate))
      user_management:
        provider: local
        local:
          users:
          - name: admin
            password: admin
          - name: hm
            password: hm-password
      cpi_job: azure_cpi
    hm:
      director_account:
        user: hm
        password: hm-password
        ca_cert: ((director_ssl.ca))
      resurrector_enabled: true
    ntp: &ntp
    - 
    agent:
      mbus: nats://nats:nats-password@192.168.10.20:4222
    registry:
      address: 192.168.10.20
      host: 192.168.10.20
      db: # todo remove
        host: 127.0.0.1
        user: postgres
        password: postgres-password
        database: bosh
        adapter: postgres
      http:
        user: registry
        password: registry-password
        port: 25777
      username: registry
      password: registry-password
      port: 25777
    azure: &cpi_conf
      environment: AzureCloud
      subscription_id: 41ddf816-91e9-4bac-94b6-806c2ccb8630
      tenant_id: aeacdca2-4f9e-4bc5-8c8b-b0403fbdcfd1
      client_id: 6011987b-9891-433f-8f84-f6465a45659c
      client_secret: 26W48w5VpOCBnTkzJUMxg9klTPkW6OzlJT23zwV87BE=
      resource_group_name: bootstrap_deploy_test
      storage_account_name: bootstrapstoragetest
      default_security_group: nsg-bootstrap
      ssh_user: vcap
      ssh_public_key: |+
        ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQC5IXyvG1tEw9lvXZLPYqBrbGu8YmhqMiyG5ilKw8hItzeRQda0Gqzszhbw+cVZK7lC90n9597tQiEy1CABvPK5aTC1KwrnxuWJ1BeUUqIiwuZ9uRdngBCptF6Cq52gx0ULq2KJP6GP2KiZYhAgcPaejvNwMY4L9MAYZNuP4bOPlvGeg7gtQJMysneSTd7sCwrN87VdIweEdZyGBX0TpmCmLdN3IV2LkYneMR4Ei/ov+athD52ViD6TRCaxzr0XRsnofXtp//NrgBkwKUhfi12pI5CaZiM/HjiIYxUTjkJ14Xg4XOiqQQrO4BGA1b+HNBSx6SJfgbXD4UY/s6UcosmJ

cloud_provider:
  mbus: https://mbus:mbus-password@52.231.198.194:6868
  properties:
    agent: {mbus: "https://mbus:mbus-password@0.0.0.0:6868"}
    blobstore: {provider: local, path: /var/vcap/micro_bosh/data/cache}
    ntp: *ntp
    azure: *cpi_conf
  template:
    name: azure_cpi
    release: bosh-azure-cpi
  ssh_tunnel:
    host: 52.231.198.194
    port: 22
    user: vcap
    private_key: /home/cloud4u/.ssh/azure_pub

variables:
- name: default_ca
  type: certificate
  options:
    is_ca: true
    common_name: ca

- name: director_ssl
  type: certificate
  options:
    ca: default_ca
    common_name: 52.231.198.194
    alternative_names: [52.231.198.194]

- name: nats_ca
  type: certificate
  options:
    is_ca: true
    common_name: default.nats-ca.bosh-internal

- name: nats_server_tls
  type: certificate
  options:
    ca: nats_ca
    common_name: default.nats.bosh-internal
    alternative_names: [192.168.10.20]
    extended_key_usage:
    - server_auth

- name: nats_clients_director_tls
  type: certificate
  options:
    ca: nats_ca
    common_name: default.director.bosh-internal
    extended_key_usage:
    - client_auth

- name: nats_clients_health_monitor_tls
  type: certificate
  options:
    ca: nats_ca
    common_name: default.hm.bosh-internal
    extended_key_usage:
    - client_auth