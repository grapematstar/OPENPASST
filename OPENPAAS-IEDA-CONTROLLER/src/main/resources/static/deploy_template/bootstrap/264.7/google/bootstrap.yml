---
name: bosh

releases:
- name: bosh
  version: [boshReleaseVersion]
  url: file:///[boshRelease]
- name: bosh-google-cpi
  version: [boshCpiReleaseVersion]
  url: file:///[boshCpiRelease]
- name: os-conf
  version: [boshOsConfVersion]
  url: file:///[boshOsConfRelease]

resource_pools:
- name: vms
  network: private
  stemcell: 
    url: file:///[stemcell]
  cloud_properties: 
    zone: [availabilityZone]
    machine_type: [cloudInstanceType]
    root_disk_size_gb: [rootDiskSizeGb]
    root_disk_type: [rootDiskType]
  env:
    bosh:
      password: [boshPassword]

disk_pools:
- name: disks
  disk_size: 40960
  cloud_properties: {type: [rootDiskType]}

networks:
- name: private
  type: manual
  subnets:
  - range: [subnetRange]
    gateway: [subnetGateway]
    static: [[privateStaticIp]]
    dns: [[subnetDns]]
    cloud_properties: 
      network_name: [networkName]
      subnetwork_name: [subnetId]
      ephemeral_external_ip: false
      tags: [[defaultSecurityGroups]]
- name: public
  type: vip

instance_groups:
- name: bosh
  instances: 1
  jobs: 
  - {name: nats, release: bosh}
  - {name: postgres-9.4, release: bosh}
  - {name: blobstore, release: bosh}
  - {name: director, release: bosh}
  - {name: health_monitor, release: bosh}
  - {name: google_cpi, release: bosh-google-cpi}
  - {name: user_add, release: os-conf}
  resource_pool: vms
  persistent_disk_pool: disks
  networks:
  - name: private
    static_ips: [[privateStaticIp]]
    default: [dns, gateway]
  - name: public
    static_ips: [[publicStaticIp]]
  properties:
    nats:
      address: [privateStaticIp]
      user: nats
      password: nats-password
      tls:
        ca: ((nats_server_tls.ca))
        client_ca:
          certificate: ((nats_ca.certificate))
          private_key: ((nats_ca.private_key))
        server:
          certificate: ((nats_server_tls.certificate))
          private_key: ((nats_server_tls.private_key))
        director:
          certificate: ((nats_clients_director_tls.certificate))
          private_key: ((nats_clients_director_tls.private_key))
        health_monitor:
          certificate: ((nats_clients_health_monitor_tls.certificate))
          private_key: ((nats_clients_health_monitor_tls.private_key))
    postgres: &db
      listen_address: 127.0.0.1
      host: 127.0.0.1
      user: postgres
      password: postgres-password
      database: bosh
      adapter: postgres
    blobstore:
      address: [privateStaticIp]
      port: 25250
      provider: dav
      director:
        user: director
        password: director-password
      agent:
        user: agent
        password: agent-password
    director:
      address: 127.0.0.1
      name: [directorName]
      db: *db
      flush_arp: true
      enable_post_deploy: true
      generate_vm_passwords: true
      enable_dedicated_status_worker: true
      enable_nats_delivered_templates: true
      workers: 4
      local_dns:
        enabled: true
      events:
        record_events: true
      ssl:
        key: ((director_ssl.private_key))
        cert: ((director_ssl.certificate))
      default_ssh_options:
        gateway_host: [publicStaticIp]
      user_management:
        provider: local
        local:
          users:
          - name: admin
            password: admin
          - name: hm
            password: hm-password
      cpi_job: google_cpi
    hm:
      director_account:
        user: hm
        password: hm-password
      resurrector_enabled: true
    ntp: &ntp
    - 169.254.169.254
    agent:
      mbus: nats://nats:nats-password@[privateStaticIp]:4222
    google: 
      project: paas-ta-198701
      json_key: |+
        {  "type": "service_account",  "project_id": "paas-ta-198701",  "private_key_id": "1e47e2554132f19c1725c64cec838509c3cd5ca9",  "private_key": "-----BEGIN PRIVATE KEY-----\nMIIEvQIBADANBgkqhkiG9w0BAQEFAASCBKcwggSjAgEAAoIBAQCasxTqMtK9GwXa\n+9LF/YxZF2/uV+msefY4XJANMhMInIwgQHehtaFVv1tP6YjpBVPtQnweCfd6FBlr\nBSCSMjbqI7LmrYU6b1KnEQntRaMNfdF/z67uCXpe3QI1z4Ucc4TCljzm7+sZXM0Y\nE+8Nhc0qHZYOkmzXH2V/SLd48F+msKSYm1Ghw0xV71abCizya72eH83y8OZaSYoZ\nHWzVyysM8k3QeeCrfc91MoHL6DZHWV21T3fbmuNtWOkJ2ClcltH5mniPUSzPZ6kw\nfqP1UB0QR1HdEBI0F11DWZ90UdANyhzzJoSbAy7lk/fuNH3+QBNLibg2h3R3bWQ4\nDnCp36H5AgMBAAECggEAKjuUjKFGVfkAHrnb31BqVdInrQ5UDVGYbeebLfcLKjEu\nsglXf46p1lJw176eMVtSf7XEU6EN7kZ5b/WM4EyUIFSRnRcnBX5ptpFYv+1gZ6j/\nHiDxFSwCO86jMVSPduZ0injgdH1wFdL3bMjYXL039vTvx9einhIEr/yGlh4tRsCK\n2IvHdR6clZ/6PzYuNwSt/AvtI0PLGGe6DTZCahAiWKFLurPKw1mD3mCFTlge+59h\n1x3uqBNKWk301rGHeA43ANNfIVn7NWZh1JwQEmRBsPnzh5kLYiM+/Enz/7coJCH+\n5tSDFUYMR0VHsp/I7To4sNWTDzNUzoA3JuWILOYmVwKBgQDPDxthEgmJYLhSLmU1\nMePiVJCX8V/du5GtQZWuD0Md2UvE/zs5Rty+0m4MOYiwhGcRLHzMh7QHOZ7jlPv5\njs0uYgWodvse96ARGyZOl0Z+fc/+ns9zbm/NGDzsEM8n2v8tRhtJOmQJBpEss/NX\n6mYk0nGKcOSUe2WmR6t0jXO/vwKBgQC/Q8QBShtV0uNUMQAmSZt7CcYGKbs9DsU4\nYZhrgLSWhgW5OufEJNhdNYnDZ5WuuvbbU2t4/2HmVMKu3AasZMZwtBXnjsmHnBOG\nnOQGQ3vHQxhRHEpLAfhVLJC3g6jG3yLj0RS76AVWmeoa5C6gLb9co+p4zxEr81g9\nPWgSCFeMRwKBgQCepa6Os6lG7yqLHS1CktVORwj6wmB3ng3COCwdT2hXaHTbncuc\n2SStuMHE8BhBV1E5IWMFuzw/BPEu4qolzjp7vXMkXvWOBqFIOgsh0Fqc9Hz3VGsS\nwJ09AcM8BK0UloFKCRtDAlA/ch6tp7tdsyVMNUn1jwY0lk+OFf/Sr8buNQKBgCmJ\ntRK2nnMoJrjNH4QxLjQtbjU+cOyUvZ4+C9UlEZMzLiEJOvZtLhQoIXAvmeFlt2Dw\noAGaLQ/RzqodHNHp3PLzGWK9ruTlr5PnlNoLY+Fln+1VoIjjt6P/1roUPN5b7X7e\nlIsum6IwMRh//+RHqyyaaLyt88PAyKQcJvLrnt/XAoGAXNOcknudCypSRS8sWJNc\nrA5eGFNB1wKWRcFzkIkSVszDZPBvN1rP3i4pDk1u5u293N9V4omjzG8TQt7roP5R\nPaKg6szx11/auFChEHRY5KLD19W83vEGWPtXWIUnEe6PfS3TlDZrm/IjbQJPL9g1\nwHF80jEgSz+GgmFWW7UZ9B0=\n-----END PRIVATE KEY-----\n",  "client_email": "paas-ta3-1@paas-ta-198701.iam.gserviceaccount.com",  "client_id": "111079623725171766458",  "auth_uri": "https://accounts.google.com/o/oauth2/auth",  "token_uri": "https://accounts.google.com/o/oauth2/token",  "auth_provider_x509_cert_url": "https://www.googleapis.com/oauth2/v1/certs",  "client_x509_cert_url": "https://www.googleapis.com/robot/v1/metadata/x509/paas-ta3-1%40paas-ta-198701.iam.gserviceaccount.com"}
    users:
    - name: vcap
      public_key: [sshKeyFile]

cloud_provider:
  mbus: https://mbus:mbus-password@[publicStaticIp]:6868
  properties:
    agent: {mbus: "https://mbus:mbus-password@0.0.0.0:6868"}
    blobstore: {provider: local, path: /var/vcap/micro_bosh/data/cache}
    ntp: *ntp
    google: 
      project: paas-ta-198701
      json_key: |+
        {  "type": "service_account",  "project_id": "paas-ta-198701",  "private_key_id": "1e47e2554132f19c1725c64cec838509c3cd5ca9",  "private_key": "-----BEGIN PRIVATE KEY-----\nMIIEvQIBADANBgkqhkiG9w0BAQEFAASCBKcwggSjAgEAAoIBAQCasxTqMtK9GwXa\n+9LF/YxZF2/uV+msefY4XJANMhMInIwgQHehtaFVv1tP6YjpBVPtQnweCfd6FBlr\nBSCSMjbqI7LmrYU6b1KnEQntRaMNfdF/z67uCXpe3QI1z4Ucc4TCljzm7+sZXM0Y\nE+8Nhc0qHZYOkmzXH2V/SLd48F+msKSYm1Ghw0xV71abCizya72eH83y8OZaSYoZ\nHWzVyysM8k3QeeCrfc91MoHL6DZHWV21T3fbmuNtWOkJ2ClcltH5mniPUSzPZ6kw\nfqP1UB0QR1HdEBI0F11DWZ90UdANyhzzJoSbAy7lk/fuNH3+QBNLibg2h3R3bWQ4\nDnCp36H5AgMBAAECggEAKjuUjKFGVfkAHrnb31BqVdInrQ5UDVGYbeebLfcLKjEu\nsglXf46p1lJw176eMVtSf7XEU6EN7kZ5b/WM4EyUIFSRnRcnBX5ptpFYv+1gZ6j/\nHiDxFSwCO86jMVSPduZ0injgdH1wFdL3bMjYXL039vTvx9einhIEr/yGlh4tRsCK\n2IvHdR6clZ/6PzYuNwSt/AvtI0PLGGe6DTZCahAiWKFLurPKw1mD3mCFTlge+59h\n1x3uqBNKWk301rGHeA43ANNfIVn7NWZh1JwQEmRBsPnzh5kLYiM+/Enz/7coJCH+\n5tSDFUYMR0VHsp/I7To4sNWTDzNUzoA3JuWILOYmVwKBgQDPDxthEgmJYLhSLmU1\nMePiVJCX8V/du5GtQZWuD0Md2UvE/zs5Rty+0m4MOYiwhGcRLHzMh7QHOZ7jlPv5\njs0uYgWodvse96ARGyZOl0Z+fc/+ns9zbm/NGDzsEM8n2v8tRhtJOmQJBpEss/NX\n6mYk0nGKcOSUe2WmR6t0jXO/vwKBgQC/Q8QBShtV0uNUMQAmSZt7CcYGKbs9DsU4\nYZhrgLSWhgW5OufEJNhdNYnDZ5WuuvbbU2t4/2HmVMKu3AasZMZwtBXnjsmHnBOG\nnOQGQ3vHQxhRHEpLAfhVLJC3g6jG3yLj0RS76AVWmeoa5C6gLb9co+p4zxEr81g9\nPWgSCFeMRwKBgQCepa6Os6lG7yqLHS1CktVORwj6wmB3ng3COCwdT2hXaHTbncuc\n2SStuMHE8BhBV1E5IWMFuzw/BPEu4qolzjp7vXMkXvWOBqFIOgsh0Fqc9Hz3VGsS\nwJ09AcM8BK0UloFKCRtDAlA/ch6tp7tdsyVMNUn1jwY0lk+OFf/Sr8buNQKBgCmJ\ntRK2nnMoJrjNH4QxLjQtbjU+cOyUvZ4+C9UlEZMzLiEJOvZtLhQoIXAvmeFlt2Dw\noAGaLQ/RzqodHNHp3PLzGWK9ruTlr5PnlNoLY+Fln+1VoIjjt6P/1roUPN5b7X7e\nlIsum6IwMRh//+RHqyyaaLyt88PAyKQcJvLrnt/XAoGAXNOcknudCypSRS8sWJNc\nrA5eGFNB1wKWRcFzkIkSVszDZPBvN1rP3i4pDk1u5u293N9V4omjzG8TQt7roP5R\nPaKg6szx11/auFChEHRY5KLD19W83vEGWPtXWIUnEe6PfS3TlDZrm/IjbQJPL9g1\nwHF80jEgSz+GgmFWW7UZ9B0=\n-----END PRIVATE KEY-----\n",  "client_email": "paas-ta3-1@paas-ta-198701.iam.gserviceaccount.com",  "client_id": "111079623725171766458",  "auth_uri": "https://accounts.google.com/o/oauth2/auth",  "token_uri": "https://accounts.google.com/o/oauth2/token",  "auth_provider_x509_cert_url": "https://www.googleapis.com/oauth2/v1/certs",  "client_x509_cert_url": "https://www.googleapis.com/robot/v1/metadata/x509/paas-ta3-1%40paas-ta-198701.iam.gserviceaccount.com"}
  template:
    name: google_cpi
    release: bosh-google-cpi

variables:
- name: default_ca
  type: certificate
  options:
    is_ca: true
    common_name: ca

- name: director_ssl
  type: certificate
  options:
    ca: default_ca
    common_name: [publicStaticIp]
    alternative_names: [[publicStaticIp]]

- name: nats_ca
  type: certificate
  options:
    is_ca: true
    common_name: default.nats-ca.bosh-internal

- name: nats_server_tls
  type: certificate
  options:
    ca: nats_ca
    common_name: default.nats.bosh-internal
    alternative_names: [[privateStaticIp]]
    extended_key_usage:
    - server_auth

- name: nats_clients_director_tls
  type: certificate
  options:
    ca: nats_ca
    common_name: default.director.bosh-internal
    extended_key_usage:
    - client_auth

- name: nats_clients_health_monitor_tls
  type: certificate
  options:
    ca: nats_ca
    common_name: default.hm.bosh-internal
    extended_key_usage:
    - client_auth
